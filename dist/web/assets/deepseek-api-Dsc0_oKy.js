var E=Object.defineProperty;var S=(t,e,s)=>e in t?E(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var h=(t,e,s)=>S(t,typeof e!="symbol"?e+"":e,s);import{A as i,r as l,e as c}from"./index-C2Li2ij-.js";class y{constructor(e){h(this,"apiKey");h(this,"baseUrl");this.apiKey=e,this.baseUrl=i.DEEPSEEK_BASE_URL}async generateChat(e,s="deepseek-chat",p=4e3){const r=await l(`${this.baseUrl}/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:s,messages:e,max_tokens:p,temperature:.7}),timeout:i.REQUEST_TIMEOUT});if(!r.ok)throw c.createApiError(r.status,r.statusText,"DeepSeek API");const a=await r.json();if(!a.choices||a.choices.length===0)throw c.createResponseError("空的响应","DeepSeek API");return a.choices[0].message.content}async generateWeeklyReport(e,s,p="deepseek-chat",r=4e3){var u;const a=[{role:"system",content:s},{role:"user",content:`以下是GitLab事件数据：

${e}

请根据这些数据生成工作周报。`}],o=await l(`${i.DEEPSEEK_BASE_URL}/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:p,messages:a,max_tokens:r,temperature:.7}),timeout:i.REQUEST_TIMEOUT});if(!o.ok)throw c.createApiError(o.status,o.statusText,"DeepSeek API");const n=await o.json();if(!n.choices||n.choices.length===0)throw c.createResponseError("空的响应","DeepSeek API");return{content:n.choices[0].message.content,tokensUsed:((u=n.usage)==null?void 0:u.total_tokens)||0}}async validateApiKey(){try{return await this.generateChat([{role:"user",content:"Hello"}],"deepseek-chat",10),!0}catch{return!1}}}function A(t){return new y(t)}export{y as DeepSeekApiService,A as createDeepSeekApiService};
